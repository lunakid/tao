Design: support both local and client-server operation